<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Khaled and Manna's Space</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #ffeef5; /* soft powdery pink */ 
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .tanks {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
    }
    .tanks {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
    }
    .tank {
      width: 48%;
      text-align: center;
      padding: 10px;
      border-radius: 10px;
      background: #ebebeb; /* light gray */ 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .progress {
      width: 100%;
      height: 30px;
      border-radius: 5px;
      background: #ddd;
      margin: 10px 0;
      overflow: hidden;
    }
        .progress {
      width: 100%;
      height: 30px;
      border-radius: 5px;
      background: #ddd;
      margin: 10px 0;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      transition: width 0.3s;
    }
    .khaled .progress-fill {
      background: #003366; /* deep navy blue */
    }
    .manna .progress-fill {
      background: #b30059; /* deep raspberry pink */
    }
    button {
      margin: 5px;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.8;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    ul {
      list-style: none;
      padding: 0;
    }
        li {
      padding: 5px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
    }
    li small {
      color: gray;
      margin-left: 10px;
    }
    .actions button {
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <h1>Khaled and Manna's Space</h1>
    <!-- Love Tanks -->
<div class="tanks">
  <div class="tank khaled">
    <h3>Khaled's Tank</h3>
    <div class="progress"><div class="progress-fill" id="khaled-fill"></div></div>
    <button onclick="updateTank('khaled', -20)">-</button>
    <button onclick="updateTank('khaled', 20)">+</button>
  </div>
  <div class="tank manna">
    <h3>Manna's Tank</h3>
    <div class="progress"><div class="progress-fill" id="manna-fill"></div></div>
    <button onclick="updateTank('manna', -20)">-</button>
    <button onclick="updateTank('manna', 20)">+</button>
  </div>
</div>
    <!-- Notes -->
  <div class="section">
    <h3>Notes </h3>
    <input type="text" id="noteInput" placeholder="Write a note...">
    <button onclick="addNote()">Add Note</button>
    <ul id="notesList"></ul>
  </div>

  <!-- Topics -->
  <div class="section">
    <h3>Topics to Talk About </h3>
    <input type="text" id="topicInput" placeholder="Add a topic...">
    <button onclick="addTopic()">Add Topic</button>
    <ul id="topicsList"></ul>
  </div>

  <!-- To-Do List -->
  <div class="section">
    <h3>To-Do List </h3>
    <input type="text" id="todoInput" placeholder="Suggest an activity...">
    <button onclick="addTodo()">Add Request</button>
     <h4>Approved Activities</h4>
    <ul id="approvedList"></ul>
   <h4>Pending Requests</h4>
    <ul id="pendingList"></ul>
  </div>
  <!-- Firebase + JS -->
<script type="module">
  // --- Firebase imports ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { 
    getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, 
    collection, addDoc, deleteDoc 
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // --- Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyA_1mznVFDuuC-LV2ALwBMZCD1GshYk8eQ",
    authDomain: "khaled-manna-space-69ddd.firebaseapp.com",
    projectId: "khaled-manna-space-69ddd",
    storageBucket: "khaled-manna-space-69ddd.firebasestorage.app",
    messagingSenderId: "358770486404",
    appId: "1:358770486404:web:4773fda8886657e69326d1"
  };
    // --- Init ---
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // --- Tanks ---
  async function updateTank(person, change) {
    const ref = doc(db, "tanks", "levels");
    try {
      const snap = await getDoc(ref);
      if (snap.exists()) {
        let current = snap.data()[person] || 0;
        let newVal = Math.max(0, Math.min(100, current + change));
        console.log("Updating", person, "to", newVal);
        await updateDoc(ref, { [person]: newVal });
      } else {
        console.log("No doc found, creating default");
        await setDoc(ref, { khaled: 0, manna: 0 });
      }
    } catch (err) {
      console.error("Error updating tank:", err);
    }
  }
    // Real-time listener
  onSnapshot(doc(db, "tanks", "levels"), (docSnap) => {
    if (docSnap.exists()) {
      const data = docSnap.data();
      console.log("Snapshot update:", data);
      document.getElementById("khaled-fill").style.width = (data.khaled || 0) + "%";
      document.getElementById("manna-fill").style.width = (data.manna || 0) + "%";
    } else {
      console.log("No snapshot found for tanks/levels");
    }
  });

  // --- Notes ---
  async function addNote() {
    const val = document.getElementById("noteInput").value;
    if (val.trim() === "") return;

    await addDoc(collection(db, "notes"), { 
      text: val,
      createdAt: new Date()
    });
    document.getElementById("noteInput").value = "";
  }
  
onSnapshot(collection(db, "notes"), (snapshot) => {
    const list = document.getElementById("notesList");
    list.innerHTML = "";
    snapshot.forEach((doc) => {
      let data = doc.data();
      let date = data.createdAt?.toDate 
        ? data.createdAt.toDate() 
        : new Date(data.createdAt);
      let formatted = date.toLocaleString("en-US", {
        dateStyle: "medium",
        timeStyle: "short"
      });
      let li = document.createElement("li");
      li.innerHTML = `<span>${data.text}</span> <small>${formatted}</small>`;
      list.appendChild(li);
    });
  });
    // --- Topics ---
  async function addTopic() {
    const val = document.getElementById("topicInput").value;
    if (val.trim() === "") return;
    await addDoc(collection(db, "topics"), { text: val, done: false });
    document.getElementById("topicInput").value = "";
  }

  onSnapshot(collection(db, "topics"), (snapshot) => {
    const list = document.getElementById("topicsList");
    list.innerHTML = "";
    snapshot.forEach((docSnap) => {
      let data = docSnap.data();
  let li = document.createElement("li");
li.style.display = "flex";         // makes it inline
li.style.alignItems = "center";    // centers vertically
li.style.gap = "3px";              // spacing between checkbox and text

let checkbox = document.createElement("input");
checkbox.type = "checkbox";

let span = document.createElement("span");
span.textContent = data.text;

// Apply strikethrough if already approved
if (checkbox.checked) {
  span.style.textDecoration = "line-through";
}

// Add event listener to toggle strikethrough dynamically
checkbox.addEventListener("change", () => {
  if (checkbox.checked) {
    span.style.textDecoration = "line-through";
  } else {
    span.style.textDecoration = "none";
  }
});

li.appendChild(checkbox);
li.appendChild(span);
topicsList.appendChild(li);
    });
  });
    // --- To-do list ---
  async function addTodo() {
    const val = document.getElementById("todoInput").value;
    if (val.trim() === "") return;
    await addDoc(collection(db, "todos"), { text: val, status: "pending" });
    document.getElementById("todoInput").value = "";
  }
  onSnapshot(collection(db, "todos"), (snapshot) => {
  const pending = document.getElementById("pendingList");
  const approved = document.getElementById("approvedList");
  pending.innerHTML = "";
  approved.innerHTML = "";

  snapshot.forEach((docSnap) => {
    let data = docSnap.data();
    let li = document.createElement("li");
    li.style.display = "flex";
    li.style.alignItems = "center";

    if (data.status === "pending") {
      li.textContent = data.text;
      let div = document.createElement("div");
      div.classList.add("actions");

      let approveBtn = document.createElement("button");
      approveBtn.textContent = "";
      approveBtn.onclick = async () =>
        approveBtn.onclick = async () => {
  await updateDoc(doc(db, "todos", docSnap.id), { 
    status: "approved",
    done: false   // start unchecked
  });
};
let declineBtn = document.createElement("button");
      declineBtn.textContent = "";
      declineBtn.onclick = async () =>
        await deleteDoc(doc(db, "todos", docSnap.id));

      div.appendChild(approveBtn);
      div.appendChild(declineBtn);
      li.appendChild(div);
      pending.appendChild(li);
    } 
    
    else if (data.status === "approved") {
  let li = document.createElement("li");
  li.style.display = "flex";          // inline layout
  li.style.alignItems = "center";     // vertical alignment
  li.style.gap = "3px";               // spacing between checkbox and text

  let checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.checked = data.done === true; // only checked if explicitly true

  let span = document.createElement("span");
  span.textContent = data.text;

  // strike-through when done
  if (data.done) {
    span.style.textDecoration = "line-through";
  }

  // toggle in Firestore when clicked
  checkbox.onchange = async () => {
    await updateDoc(doc(db, "todos", docSnap.id), { done: checkbox.checked });
  };

  li.appendChild(checkbox);
  li.appendChild(span);
  approved.appendChild(li);
      }
    });
  });
               
             // --- Expose globally for buttons ---
  window.updateTank = updateTank;
  window.addNote = addNote;
  window.addTopic = addTopic;
  window.addTodo = addTodo;
  </script>
</body>
</html>
