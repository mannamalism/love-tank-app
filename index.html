<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Khaled and Manna's Space</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #ffeef5; /* soft powdery pink */
    }
    h1 {
      text-align: center;
      color: #333;
    }
    h3 {
      text-align: center;
    }
    .tanks {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin: 20px 0;
    }
    .tank {
      flex: 1; /* Use flexbox to make tanks equal width */
      text-align: center;
      padding: 10px;
      border-radius: 10px;
      background: #ebebeb; /* light gray */
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .progress {
      width: 100%;
      height: 30px;
      border-radius: 5px;
      background: #ddd;
      margin: 10px 0;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      transition: width 0.3s;
    }
    .khaled .progress-fill {
      background: #003366; /* deep navy blue */
    }
    .manna .progress-fill {
      background: #b30059; /* deep raspberry pink */
    }
    .tank button {
      margin: 5px;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.8;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      padding: 5px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
    }
    li:last-child {
      border-bottom: none;
    }
    li small {
      color: gray;
      margin-left: 10px;
    }
    .actions {
      display: flex;
      gap: 5px;
    }
    .actions button {
      font-size: 1.2em;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .checkbox-item span.done {
      text-decoration: line-through;
    }
  </style>
</head>
<body>
  <h1>Khaled and Manna's Space</h1>
  
  <div class="tanks">
    <div class="tank khaled">
      <h3>Khaled's Tank</h3>
      <div class="progress"><div class="progress-fill" id="khaled-fill"></div></div>
      <button onclick="updateTank('khaled', -20)">-</button>
      <button onclick="updateTank('khaled', 20)">+</button>
    </div>
    <div class="tank manna">
      <h3>Manna's Tank</h3>
      <div class="progress"><div class="progress-fill" id="manna-fill"></div></div>
      <button onclick="updateTank('manna', -20)">-</button>
      <button onclick="updateTank('manna', 20)">+</button>
    </div>
  </div>
  
  <div class="section">
    <h3>Notes üìù</h3>
    <input type="text" id="noteInput" placeholder="Write a note...">
    <button onclick="addNote()">Add Note</button>
    <ul id="notesList"></ul>
  </div>

  <div class="section">
    <h3>Topics to Talk About üí¨</h3>
    <input type="text" id="topicInput" placeholder="Add a topic...">
    <button onclick="addTopic()">Add Topic</button>
    <ul id="topicsList"></ul>
  </div>

  <div class="section">
    <h3>To-Do List ‚úÖüìù</h3>
    <input type="text" id="todoInput" placeholder="Suggest an activity...">
    <button onclick="addTodo()">Add Request</button>
    <h4>Approved Activities</h4>
    <ul id="approvedList"></ul>
    <h4>Pending Requests</h4>
    <ul id="pendingList"></ul>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, 
      collection, addDoc, deleteDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA_1mznVFDuuC-LV2ALwBMZCD1GshYk8eQ",
      authDomain: "khaled-manna-space-69ddd.firebaseapp.com",
      projectId: "khaled-manna-space-69ddd",
      storageBucket: "khaled-manna-space-69ddd.firebasestorage.app",
      messagingSenderId: "358770486404",
      appId: "1:358770486404:web:4773fda8886657e69326d1"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- Utility Functions ---
    // Creates a list item with a checkbox and text
    const createCheckboxItem = (id, text, isDone, collectionName) => {
      const li = document.createElement("li");
      li.classList.add('checkbox-item');

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = isDone;

      const span = document.createElement("span");
      span.textContent = text;
      if (isDone) {
        span.classList.add('done');
      }

      checkbox.onchange = async () => {
        const docRef = doc(db, collectionName, id);
        await updateDoc(docRef, { done: checkbox.checked });
      };

      li.appendChild(checkbox);
      li.appendChild(span);
      return li;
    };

    // --- Tanks ---
    window.updateTank = async (person, change) => {
      const ref = doc(db, "tanks", "levels");
      try {
        const snap = await getDoc(ref);
        let current = snap.exists() ? snap.data()[person] : 0;
        let newVal = Math.max(0, Math.min(100, current + change));
        await setDoc(ref, { [person]: newVal }, { merge: true });
      } catch (err) {
        console.error("Error updating tank:", err);
      }
    };
    
    onSnapshot(doc(db, "tanks", "levels"), (docSnap) => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("khaled-fill").style.width = (data.khaled || 0) + "%";
        document.getElementById("manna-fill").style.width = (data.manna || 0) + "%";
      }
    });

    // --- Notes ---
    window.addNote = async () => {
      const input = document.getElementById("noteInput");
      const text = input.value.trim();
      if (!text) return;
      await addDoc(collection(db, "notes"), { text, createdAt: new Date() });
      input.value = "";
    };

    onSnapshot(collection(db, "notes"), (snapshot) => {
      const notes = [];
      snapshot.forEach(docSnap => notes.push({ id: docSnap.id, ...docSnap.data() }));
      notes.sort((a, b) => b.createdAt?.toDate() - a.createdAt?.toDate());

      const list = document.getElementById("notesList");
      list.innerHTML = "";
      
      notes.forEach(note => {
        const date = note.createdAt?.toDate().toLocaleString("en-US", { dateStyle: "medium", timeStyle: "short" });
        const li = document.createElement("li");
        
        const content = document.createElement("span");
        content.innerHTML = `${note.text} <small>${date}</small>`;
        
        const heartButton = document.createElement("button");
        heartButton.innerHTML = note.liked ? "‚ù§Ô∏è" : "ü§ç";
        heartButton.style.cssText = "border: none; background: transparent; cursor: pointer; font-size: 1.2em;";
        heartButton.onclick = async () => {
          await updateDoc(doc(db, "notes", note.id), { liked: !note.liked });
        };
        
        li.appendChild(content);
        li.appendChild(heartButton);
        list.appendChild(li);
      });
    });

    // --- Topics ---
    window.addTopic = async () => {
      const input = document.getElementById("topicInput");
      const text = input.value.trim();
      if (!text) return;
      await addDoc(collection(db, "topics"), { text, done: false });
      input.value = "";
    };

    onSnapshot(collection(db, "topics"), (snapshot) => {
      const topics = [];
      snapshot.forEach(docSnap => topics.push({ id: docSnap.id, ...docSnap.data() }));
      
      const list = document.getElementById("topicsList");
      list.innerHTML = "";
      topics.forEach(topic => {
        const li = createCheckboxItem(topic.id, topic.text, topic.done, "topics");
        list.appendChild(li);
      });
    });

    // --- To-Do List ---
    window.addTodo = async () => {
      const input = document.getElementById("todoInput");
      const text = input.value.trim();
      if (!text) return;
      await addDoc(collection(db, "todos"), { text, status: "pending", done: false });
      input.value = "";
    };

    onSnapshot(collection(db, "todos"), (snapshot) => {
      const pendingList = document.getElementById("pendingList");
      const approvedList = document.getElementById("approvedList");
      pendingList.innerHTML = "";
      approvedList.innerHTML = "";
      
      const allTodos = [];
      snapshot.forEach(docSnap => allTodos.push({ id: docSnap.id, ...docSnap.data() }));

      const pendingItems = allTodos.filter(item => item.status === "pending");
      const approvedItems = allTodos.filter(item => item.status === "approved");

      // Sort approved items: unchecked first
      approvedItems.sort((a, b) => (a.done === b.done) ? 0 : a.done ? 1 : -1);

      pendingItems.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item.text;
        
        const actions = document.createElement("div");
        actions.classList.add("actions");
        
        const approveBtn = document.createElement("button");
        approveBtn.textContent = "‚úî";
        approveBtn.onclick = async () => await updateDoc(doc(db, "todos", item.id), { status: "approved" });
        
        const declineBtn = document.createElement("button");
        declineBtn.textContent = "‚úñ";
        declineBtn.onclick = async () => await deleteDoc(doc(db, "todos", item.id));

        actions.appendChild(approveBtn);
        actions.appendChild(declineBtn);
        li.appendChild(actions);
        pendingList.appendChild(li);
      });
      
      approvedItems.forEach(item => {
        const li = createCheckboxItem(item.id, item.text, item.done, "todos");
        approvedList.appendChild(li);
      });
    });
  </script>
</body>
</html>

